
--- # src/adventure/game.yaml
game: Cricket 
author: Tom Jefferys
gameId: abcedf1234
version: 0.1
foo: bar
options:
  - useDefaultVerbs
--- # src/adventure/rooms/outside.yaml
room: out
name: out
description: |
  You head out to the cricket match.
  
  The end
--- # src/adventure/rooms/stairs.yaml
room: stairs
name: stairs
description: |
  The stairs start to descend into the gloom, there is a light switch here.
exits:
  down: cellar_west
  up: hallway
--- # src/adventure/rooms/cellar_west.yaml
room: cellar_west
name: cellar (west)
description: |
  {{#firstTime}}
  You walk carefully down the stairs, the wood shifts and creaks as you descend
  {{/firstTime}}
  There is clutter everywhere. Some shelves line the walls.
darkdesc: |
  Shafts of light shine through a few holes in the floor above, illuminating dustmotes and the bare floor beneath you.
exits:
  up: stairs
  east: cellar_east
tags: [dark]
--- # src/adventure/rooms/secret_room.yaml
room: secret_room
name: secret room
description: |
  You did not know this room existed
--- # src/adventure/rooms/cellar_east.yaml
room: cellar_east
name: cellar (east)
description: |
  The east end of the cellar.  The boiler for the house is here, and next to it attached to the wall is the fuse box.
  The cellar extends to the south, and there is a small dimly lit alcove to the north.
darkdesc: |
  You can barely see a thing, the only light is from the glow of the inspection window on the boiler, and some faint light
  from an alcove in the north.
exits:
  west: cellar_west
  south: cellar_south
  north: cellar_alcove
tags: [dark]
--- # src/adventure/rooms/hallway.yaml
room: hallway
name: hallway
description: |
  {{#firstTime}}
  The sun is shining, its a beautiful day.
  A handful of small clouds drift aimlessly across the unblemished sky.
  Trees sway in the gentle morning breeze, and crickets chirp happily in the garden.
  {{br}}
  You stretch, and breathe in the warm summer air.
  {{br}}
  It's a perfect day for a game of cricket.
  {{br}}
  You've been invited to open batting for the village's first XI, 
  it's a great honour an a chance to show Cornelius that you've got what it takes.
  {{br}}
  Just need to fetch your lucy bat from the cellar.
  {{/firstTime}}

  You are standing at your front door, nearby stairs lead down to the cellar. 
  A clock hangs on the wall.
tags: [start]
exits:
  north: out
  down: stairs
before:
  go(north):
    when: not(isCarrying(cricket_bat))
    do: '"You can&apos;t leave without your lucky cricket bat!"'
--- # src/adventure/rooms/cellar_alcove.yaml
room: cellar_alcove
name: Alcove
description: |
  A small alcove, dim light filters in through a leaf covered skylight.
exits:
  south: cellar_east

--- # src/adventure/rooms/cellar_south.yaml
room: cellar_south
name: cellar (south)
description: |
  This part of the cellar is filled with the previous occupants bric-a-brac, you never got round to clearing it out.
darkdesc: |
  It's pitch black, no light penetrates this corner of the cellar
after:
  look:
    when: hasTag(this, 'dark') && (stickers.location == 'cellar_south')
    do: 
        - print(darkdesc)
        - print('There is a faint glowing coming from the floor')
exits:
  north: cellar_east
tags: [dark]
--- # src/adventure/items/chair.yaml
item: chair
name: chair
description: |
  Rough and uncomfortable, made of sturdy but unfinished wood.
  No one has ever wanted to sit on it, the risk of a painful splinter too high.
location: cellar_south
sat_on: false
standing_on: false
tags:
  - pushable
verbs: 
  - stand: sat_on
  - sit: not(sat_on) 
  - stand_on: not(standing_on)
  - get_down: standing_on
before:
  go($direction):
    switch:
      - when: sat_on
        do: print("You're not going anywhere whilst sitting down")
      - when: standing_on
        do: print("You need to get off the chair first")
  push(this, $direction):
     when: or(sat_on, standing_on)
     do: print("You need to get off the chair before you push it")
  sit(this):
    when: not(sat_on)
    do: 
      - print("You sit on the chair")
      - standing_on = false
      - sat_on = true
    otherwise: "'You are already sitting on the chair'"
  stand:
    when: sat_on
    do:
      - print("You stand up")
      - sat_on = false
    otherwise: print("You are already standing")
  stand_on(this):
    when: not(standing_on)
    do:
      - print("You carefully stand on the wooden chair")
      - sat_on = false
      - standing_on = true
  get_down:
    when: standing_on
    do:
      - print("You step down from the chair")
      - standing_on = false
after:
  look:
    switch:
      - when: sat_on
        do: print("You are sitting on the chair")
      - when: standing_on
        do: print("You are standing on the chair")
---
verb: stand_on
name: stand on
tags: [transitive]
---
verb: get_down
name: get down
tags: [intransitive]
---
verb: sit
tags: ["transitive"]
---
verb: stand
name: stand
tags: [intransitive]
--- # src/adventure/items/boiler.yaml
item: boiler
name: boiler
location: cellar_east
description: |
  Despite the warm weather, the boiler is on, humming away to itself, probably providing heat to the hot water tank.
  Long overdue a service it coughs and wheezes like emphasemic old man.
  Every now and them a rattle comes from the flue.
verbs: 
  - spray.on
--- # src/adventure/items/fuse_box.yaml
item: fuse_box
name: fuse box
location: cellar_east
description: |
  The house was rewired recently, after one too many shocking incidents. The old fuse wire, has been replaced with
  new shiny minature circuit breakers.
# Fuse box, full of switches.  What do they do
--- # src/adventure/items/rd50.yaml
item: rd50
name: RD-50
article: a can of
description:
  A can of RD-50. *For all your lubrication and rust removal needs*
location: cellar_east
tags: 
  - carryable
verbs:
  - spray: isHolding(this)
---
verb: spray
tags:
  - transitive
attributes: ['on']
actions:
  spray($spray).on($that): print("You spray some RD-50 on the {{that.name}}")

--- # src/adventure/items/cricket_bat.yaml
item: cricket_bat
name: cricket bat
location: cellar_west
description: A wooden cricket bat, stained and dented with many years of loyal service
tags: [carryable]
--- # src/adventure/items/clock.yaml
item: clock
name: clock
location: hallway
hour: 10
minute: 0
minuteDisplay: "00"
description: |
  An old imposing grandfather clock. The second hand ticks urgently through the minutes.

  It's {{hour}}:{{minuteDisplay}}.
  
  The match starts at 10:30
---
rule: tick
afterTurn():
  - clock.minute += 1
  - clock.minuteDisplay = String.padStart("" + clock.minute, 2, '0') # str() method to convert to string
  - return false # This shouldn't be necessary
--- # src/adventure/items/bird_feeder.yaml
item: bird_feeder
name: bird feeder
description: |
  You used to hang the bird feeder out in the back yard, but Harry kept catching the poor blighters.
  Blood and feathers all over the lawn
  Your new past-time as a twitcher was swiftly abandoned and the feeder brought inside.
location: cellar_alcove
is_stuck: true
verbs:
#  - put.in
  - spray.on
tags:
  - carryable
  - container
  - openable
before:
  get($item):
    when: isAtLocation(item, bird_feeder) && !is_open
    do: print("The bird feeder is closed")
  open(this):
    when: is_stuck
    do: print("You twist the lid as hard as you can but it is completely rusted shut.")
after:
  examine(this): 
    when: isAtLocation(peanut, bird_feeder)
    do: 
      - reveal(peanut)
      - print("A lonely looking peanut sits at the bottom of the feeder")
      - return(false)
  spray(rd50).on(this):
    when: is_stuck
    then:
      - print("The rust dissolves")
      - is_stuck = false
    otherwise:
      - print("You've already removed the rust, the RD50 just makes it slippery")
      
    

--- # src/adventure/items/pet_carrier.yaml
item: pet_carrier
name: pet carrier
location: shelves
description: |
  An old plastic pet carrier. Could hold a medium sized cat.
  A metal door at the front allows the animal in and out.
  Air-holes in the top allow it to breathe.
tags:
  - hidden
  - carryable
  - openable
  - container
before:
  get(this):
     when: this.location == 'shelves' && not(chair.standing_on)
     do: 
      - print("It's too high, you can't reach")
      - return true # FIXME
--- # src/adventure/items/shelves.yaml
item: shelves
name: shelves
location: cellar_west
description: Shelves extends up the wall, way beyond your reach.
relativeLocation: "on"
tags:
  - container
after:
  examine(this):
    when: hasTag(pet_carrier,'hidden')
    do:
      - reveal(pet_carrier)
     # - print(description)
      - print('On the top shelf, out of reach is a pet carrier')
containString: on shelf # TODO make this work
--- # src/adventure/items/cellar_key.yaml
item: cellar_key
name: key
description: A small chrome key
location: rat
tags:
  - carryable
  - hidden
before:
  get(this):
    when: isAtLocation(cellar_key, rat)
    then: 
      - print("The rat growls at you, and scurries away")
--- # src/adventure/items/stickers.yaml
item: stickers
location: cellar_south
description: A sheet of glow in the dark stickers depicting various superheroes
tags: [visibleWhenDark, carryable, hidden]
before:
  get(this):
    - hide(glow)
--- # src/adventure/items/rat.yaml
item: rat
name: rat
location: cellar_east
description: |
  {{#firstTime}}
  *You have spent a small fortune on exterminators, not that it did any good.
  Traps were laid everywhere.
  Baited with cheese, and fruit, and chocolate.
  Completely ignored.*
  {{br}}
  *Poison pellets scattered around the house.
  The rat thrived.*
  {{br}}
  *Stalked it round the house with the air rifle, took potshots as it raided the larder.
  Hit the cat, spent fortune on vets bills, had complicated conversation with the RSPCA.*
  {{br}}
  *Not a scratch on the rat.*
  {{br}}
  Large brown, with pink ears it looks at you contemptuously.
  {{/firstTime}}

  {{^firstTime}}
  Large, brown, with pink ears the rat looks at you 
  {{#choose}}contemptuously||contemplatively||curiously||disdainfully||disinterestedly||disparagingly||incredulously||indifferently||sceptically||suspiciously||thoughtfully||{{/choose}}.
  {{/firstTime}}

tags: 
  - NPC
after:
  examine(this):
    - when: isAtLocation(cellar_key, rat)
    - then: 
        - print("Round it's neck, on a small ribbon, is a key")
        - reveal(cellar_key)
---
rule: move_rat
scope:
  - cellar_east
  - cellar_west
  - cellar_south
  - secret_room
afterTurn():
  repeat: # Create printScope function, or ifInScope or `inScope(rat)` 
    - - printAt(rat.location, 'The rat scurries around')
      - move(rat).to(cellar_east)
    - printAt(rat.location, 'The rat cleans itself')
    - move(rat).to(cellar_south)
    - - printAt(rat.location, 'The rat disappears through a hole in the wall')
      - move(rat).to(secret_room)
    - - printAt(rat.location, 'The rat emerges from a hole')
      - move(rat).to(cellar_west)
--- # src/adventure/items/skylight.yaml
item: skylight
name: skylight
location: cellar_alcove
description: |
  The skylight sits at ground level and supplies some much needed daylight to the cellar.
  In principle that is, the glass has been partially covered in mulch and dead leaves, allowing only a dull light through.
tags:
  - openable
before:
  open(this):
    when: chair.standing_on
    then: print("The skylight was never meant for access or ventilation and is sealed shut")
    otherwise: print("You can't reach the skylight")
--- # src/adventure/items/glow.yaml
item: glow
name: glow
description: A faint glowing
location: cellar_south 
before:
  examine(this):
    - reveal(stickers)
    - "'The glow comes from some glow in the dark stickers'"
tags:
  - visibleWhenDark
--- # src/adventure/items/cellar_door.yaml
item: cellar_door
name: cellar door
description: |
  A solid door, a dead latch locks it when it shuts
location: stairs
tags: 
  - closable
before:
  open(this):
    when: isCarrying(cellar_key)
    do:
      - openExit(stairs, 'up', hallway)
      - is_shut = false
      - print("You open the door, first unlocking it with the key")
    otherwise: 
      - print("The door is locked")
  close(this):
    do:
      - closeExit(stairs, 'up')
      - is_shut = true
      - print("You close the door")


--- # src/adventure/items/peanut.yaml
item: peanut
name: peanut
description: | 
  A peanut. Out of it's shell.
  You'd hoped it would attract a woodpecker.
  *Maybe* it did.
  Those green feathers must have come from somewhere.
tags: 
  - carryable
  - hidden
location: bird_feeder

--- # src/adventure/items/lightswitch.yaml
item: light_switch
name: light switch
location: stairs
description: |
  This switch operates the lights in the cellar

  The switch is in the {{#is_on}}on{{/is_on}}{{^is_on}}off{{/is_on}} position
is_on: false
verbs: [toggle]
before: # FIXME, why does `action` not work here
  toggle(this): 
    when: not(is_on)
    do:
      - print("You turn the lights on")
      - is_on = true
      - delTag(cellar_west,"dark")
      - delTag(cellar_east,"dark")
      - delTag(cellar_south, "dark")
      - hide(glow)
    otherwise:
      - print("You turn the lights off")
      - is_on = false
      - setTag(cellar_west, "dark")
      - setTag(cellar_east, "dark")
      - setTag(cellar_south, "dark")
      - reveal(glow)
---
verb: toggle # TODO maybe move custom verbs out
tags: [transitive]